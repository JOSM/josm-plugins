<project name="osm-tag-editor-plugin" default="deploy" basedir=".">

	<!-- ant4eclipse -->
	<taskdef resource="net/sf/ant4eclipse/antlib.xml" />

	<property name="source.dir" value="${basedir}/src"/>
	<property name="target.dir" value="${basedir}/classes"/>
	<property name="library.dir" value="${basedir}/lib"/>
	<property name="distrib.dir" value="${basedir}/distrib"/>
	<property name="project.name" value="osm-tag-editor-plugin" />
	<property name="plugin.version" value="0.1" />
	
	<!-- ************************************************************************ -->
	<target name="init" description="Initializes the build environment">
		<getEclipseClasspath property="eclipse.classpath" workspace="${basedir}/.." 
					projectName="${project.name}" />
		
		
    	<buildnumber file="build.number" />	
    	<echo>[init] Build number is ${build.number}</echo>

    		
	 	<path id="project.classpath">
	 		<pathelement location="${basedir}/src" />
	 		<pathelement location="${basedir}/classes" />
	 		<path location="${eclipse.classpath}" /> 
	    </path>

		<property name="temp1" refid="project.classpath"/>
		<echo>[init] project.classpath is &lt;${temp1}%gt;</echo>
    </target>
	
	<!-- ************************************************************************ -->
	<target name="clean"
		depends="init"
		description="Cleans the existing class files">
		<delete dir="${target.dir}"/>
		<mkdir dir="${target.dir}"/>
	</target>
	
	<!-- ************************************************************************ -->
	<target name="compile"
		depends="init,clean"
		description="Compiles the Java source files">
		
		<javac srcdir="${source.dir}"
			destdir="${target.dir}"
			classpath="${eclipse.classpath}"
			debug="true"
			>
	    </javac>
	</target>
	
	<!-- ************************************************************************ -->
	<target name="jar"
		depends="compile"
		description="Builds the JAR for the plugin">
	
		<tstamp>
			<format property="timestamp" pattern="yyyy-MM-dd HH:mm:ss"/>
		 </tstamp>

		
		<jar destfile="${library.dir}/tageditor.jar">
			<fileset dir="${target.dir}"> 
			</fileset>
			
			<fileset dir="${source.dir}">
				<include name="**/*.dtd"/>
			</fileset>
			
			<fileset dir="${basedir}">
				<include name="resources/**/*.gif"/>
				<include name="resources/**/*.xml"/>
			</fileset>
			
			
 			<manifest> 			
	      		<attribute name="Plugin-Class" value="org.openstreetmap.josm.plugins.tageditor.TagEditorPlugin"/>
	      		<attribute name="Plugin-Description" value="Provides a dialog for editing tags in a tabular grid"/>
 		   		<attribute name="Plugin-Author" value="karl.guggisberg@guggis.ch"/>
 		   		<attribute name="Plugin-Early" value="false"/>
 				<attribute name="Plugin-Version" value="${plugin.version}"/>
 				<attribute name="Build-Date" value="${timestamp}"/>
 				<attribute name="Build-Id" value="${build.number}"/> 				 				
    		</manifest> 						
		</jar>
	</target>
	
	<!-- ************************************************************************ -->
	<target name="deploy" depends="jar"
			description="Deploys the plugin">		
		<copy file="${library.dir}/tageditor.jar" todir="C:\data\projekte\osm\tag-editor-plugin\plugins" />
		<copy file="${basedir}/../JOSM/dist/josm-custom.jar" todir="C:\data\projekte\osm\tag-editor-plugin" />
	</target>	
	

</project>